angular.module("CTcue:ctAutocompletion",["ngSanitize"]).config(["$compileProvider",function($compileProvider){$compileProvider.debugInfoEnabled(!1)}]).config(["$locationProvider",function($locationProvider){$locationProvider.hashPrefix("")}]).config(["$httpProvider",function($httpProvider){$httpProvider.defaults.headers.get||($httpProvider.defaults.headers.get={}),$httpProvider.defaults.headers.get["If-Modified-Since"]="0",$httpProvider.defaults.headers.get["Cache-Control"]="no-cache",$httpProvider.defaults.headers.get.Pragma="no-cache"}]),angular.module("CTcue:ctAutocompletion").controller("ctAutocompletionDemo",["$scope",function($scope){$scope.obj={}}]); angular.module("CTcue:ctAutocompletion").factory("UMLS",["$http",function($http){function POST(controller,endpoint,data,base_path,options){var url=function(base_path,controller,endpoint){return base_path=_.trimEnd(base_path,"/"),endpoint=_.trimStart(endpoint,"/"),_.filter([base_path,controller,endpoint]).join("/")}(base_path,controller,endpoint);return $http.post(url,data,options)}return{post:function(endpoint,data,API_URL){return POST("",endpoint,data,API_URL,{headers:{"X-Token":"KBwgGhjImMut0QuGCpFS","X-User":"GuestUser=>Demo"},timeout:5e3})}}}]); angular.module("CTcue:ctAutocompletion").directive("inputField",["$timeout","UMLS",function($timeout,UMLS){return{restrict:"E",scope:{obj:"="},templateUrl:"public_html/input-field/input-field.html",link:function(scope){var previousTerm="";scope.field="description",scope.isLoading=!1,scope.tookLong=!1,scope.suggestions={local:[],server:[]},scope.use_umls=!0,scope.autocompleteWarning=!1;var SUGGEST_TIMER=null,TOOK_LONG_TIMER=null;function _umlsResolve(term,API_URL){if(void 0!==term&&term.length&&(term=term.split(" ").filter(function(s){return 2<=s.length}).join(" ")),!term||term.length<2)return null;var queryObj={query:term,category:scope.category||"keyword"};return UMLS.post("autocomplete",queryObj,API_URL)}scope.suggest=function(term){if(!term||term.length<1)return previousTerm="",void(scope.suggestions={local:[],server:[]});previousTerm!==term&&(term=term.slice(0,50),previousTerm=term,scope.isLoading=!0,$timeout.cancel(SUGGEST_TIMER),$timeout.cancel(TOOK_LONG_TIMER),SUGGEST_TIMER=$timeout(function(){!function(term){var prom=_umlsResolve(term,"https://ctcue.com/umls/v2/");if(!prom)return _.set(scope.suggestions,"server",[]);prom.then(function(result){_.set(scope.suggestions,"server",result.data.hits),scope.isLoading=!1,scope.tookLong=!1,$timeout.cancel(TOOK_LONG_TIMER)},function(){_.set(scope.suggestions,"server",[{str:"Kan ctcue niet bereiken?"}]),scope.isLoading=!1,scope.tookLong=!1,$timeout.cancel(TOOK_LONG_TIMER)})}(term),function(term){var prom=_umlsResolve(term,"http://localhost:4080/v2/");if(!prom)return _.set(scope.suggestions,"local",[]);prom.then(function(result){_.set(scope.suggestions,"local",result.data.hits),scope.isLoading=!1,scope.tookLong=!1,$timeout.cancel(TOOK_LONG_TIMER)},function(){_.set(scope.suggestions,"local",[{str:"Server staat uit?"}]),scope.isLoading=!1,scope.tookLong=!1,$timeout.cancel(TOOK_LONG_TIMER)})}(term),TOOK_LONG_TIMER=$timeout(function(){scope.tookLong=!0},200)},120))}}}}]);
